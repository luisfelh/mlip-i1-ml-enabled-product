# Albumy — LLM‑powered features

This fork adds two capabilities to the original Albumy app:

- **AI‑generated alternative text for images.** Every uploaded or seeded photo gets concise, factual alt text generated by a Large Language Model and stored on the `Photo` record; templates render `alt="{{ photo.alt_text }}``.
- **Engagement Insights (beta).** At the bottom of each user’s profile page, a **Generate analysis** button runs an on‑demand Large Language Model assessment over that user’s historical posts. It summarizes top posts by simple weighted metrics and returns a short Markdown report of themes, best‑performing patterns, audience notes, and recommendations. The endpoint uses only public post data and is rate‑limited.

---

## Getting started (Conda + environment)

**Recommended Python:** This application was tested with Python 3.13.5 (good compatibility with the Flask/Jinja stack and modern libraries).

```bash
# 1) Create and activate a fresh conda env
conda create -n albumy-llm python=3.13.5 -y
conda activate albumy-llm
conda install pip

# 2) Install project requirements
python -m pip install --upgrade pip
python -m pip install --upgrade pip setuptools wheel
python -m pip install --upgrade "six>=1.16.0" "python-dateutil>=2.8.2" Faker
python -m pip install -r requirements.txt

# 3) Install LLM-related dependencies
python -m pip install google-generativeai ratelimit

# 4) Optional: server-side Markdown rendering (if you do not use the client-side parser)
python -m pip install markdown-it-py bleach
```

Set environment variables (use your shell’s syntax):

```bash
# Required — Google AI Studio key for Gemini
export GEMINI_API_KEY="YOUR_KEY"

```

Run the app:

```bash
flask forge            # seed demo data (creates images and alt text)
flask run              # start the server at http://127.0.0.1:5000
```

**Client-side Markdown rendering (optional):** add these to your base template before `</body>` and render with `DOMPurify.sanitize(marked.parse(text))`. Already done in this implementation.
```html
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
```

---

## How it works (high level)

- **Alt text:** `utils.generate_alt_text_gemini(image_path)` calls Gemini with a strict “facts‑only” prompt and rate limiting, then writes `Photo.alt_text`. Templates use that value with no fallback, ensuring every image has meaningful alternative text.
- **Engagement Insights:** `_user_post_metrics(user_id)` computes a simple weighted score from public signals (collects and comments, extendable to shares and dwell). The top *K* posts’ captions, sample comments, and images are bundled into a single Large Language Model request. The user profile includes a compact section with a button that hits `/ajax/user/<id>/engagement-insights` and renders the Markdown response.

---

## Requirements (from `requirements.txt`)

```
blinker==1.4
bootstrap-flask==1.2.0
click==7.1.1
flask-avatars==0.2.2
flask-dropzone==1.5.4
flask-login==0.5.0
flask-mail==0.9.1
flask-moment==0.9.0
flask-sqlalchemy==2.4.1
flask-whooshee==0.7.0
flask-wtf==0.14.3
flask==1.1.2
itsdangerous==1.1.0
jinja2==2.11.1
markupsafe==1.1.1
pillow>=10.1,<11
python-dotenv==0.12.0
sqlalchemy==1.3.15
werkzeug==1.0.1
whoosh==2.7.4
wtforms==2.2.1
# dev
faker==4.0.2
python-dateutil==2.8.1
six==1.14.0
text-unidecode==1.3
watchdog>=2.1.6
```

> Notes
> - Some legacy pins may not build on very new Python versions. If needed you can upgrade selected packages such as Pillow or Watchdog as you validate compatibility in your environment.
> - LLM packages (`google-generativeai`, `ratelimit`) are installed separately as shown above.


